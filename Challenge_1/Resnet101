{"cells":[{"cell_type":"markdown","source":["# Enviroment setting"],"metadata":{"id":"GHYlu1nY3mo7"}},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":5277,"status":"ok","timestamp":1668900187739,"user":{"displayName":"Jana Khoury","userId":"07701165055658242759"},"user_tz":-60},"id":"nQHmf7P2OG7p","outputId":"030098ab-74b2-4389-ebb5-a0f07e039cb5"},"outputs":[{"name":"stdout","output_type":"stream","text":["2.10.0\n"]}],"source":["import os\n","import random\n","from datetime import datetime\n","\n","import numpy as np\n","import pandas as pd\n","import seaborn as sns\n","import matplotlib as mpl\n","import matplotlib.pyplot as plt\n","from sklearn.model_selection import train_test_split\n","from sklearn.metrics import accuracy_score, f1_score, precision_score, recall_score\n","from sklearn.metrics import confusion_matrix\n","from PIL import Image\n","\n","import tensorflow as tf\n","from keras.layers import Dropout\n","from keras.layers import BatchNormalization\n","from keras.regularizers import l2\n","from tensorflow.keras.preprocessing.image import ImageDataGenerator\n","\n","\n","tfk = tf.keras\n","tfkl = tf.keras.layers\n","print(tf.__version__)"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"PkuwRtwgOLiX"},"outputs":[],"source":["# Random seed for reproducibility\n","seed = 42\n","\n","random.seed(seed)\n","os.environ['PYTHONHASHSEED'] = str(seed)\n","np.random.seed(seed)\n","tf.random.set_seed(seed)\n","tf.compat.v1.set_random_seed(seed)"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"8PxW_uy6ONZT"},"outputs":[],"source":["import warnings\n","import logging\n","\n","os.environ['TF_CPP_MIN_LOG_LEVEL'] = '2'\n","warnings.simplefilter(action='ignore', category=FutureWarning)\n","warnings.simplefilter(action='ignore', category=Warning)\n","tf.get_logger().setLevel('INFO')\n","tf.autograph.set_verbosity(0)\n","\n","tf.get_logger().setLevel(logging.ERROR)\n","tf.get_logger().setLevel('ERROR')\n","tf.compat.v1.logging.set_verbosity(tf.compat.v1.logging.ERROR)"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"BtEqZ43zOOPh"},"outputs":[],"source":["input_shape = (96, 96, 3)\n","target_size=(96,96)\n","classes = 8\n","epochs = 100\n","batch_size = 64"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"LQptTOX0OQIl"},"outputs":[],"source":["# Setting dataset directories\n","splitted_data_dir = os.path.join('Dataset/splitted_data_balanced_new')\n","training_dir = os.path.join(splitted_data_dir + '/train')\n","validation_dir = os.path.join(splitted_data_dir + '/val')"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"B4VmEzv-OSAG"},"outputs":[],"source":["# Labels of the dataset for classification\n","labels = ['Species1',\n","          'Species2',\n","          'Species3',\n","          'Species4',\n","          'Species5',\n","          'Species6',\n","          'Species7',\n","          'Species8']"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":868,"status":"ok","timestamp":1668900340100,"user":{"displayName":"Jana Khoury","userId":"07701165055658242759"},"user_tz":-60},"id":"x8xRLTvlO0nP","outputId":"2f1015e7-d077-4a9e-b963-12a30739e119"},"outputs":[{"name":"stdout","output_type":"stream","text":["Found 3896 images belonging to 8 classes.\n"]}],"source":["from tensorflow.keras.applications.resnet import preprocess_input\n","\n","# Create an instance of ImageDataGenerator with Data Augmentation\n","aug_train_data_gen = ImageDataGenerator(rotation_range=10,\n","                                        height_shift_range=25,\n","                                        width_shift_range=25,\n","                                        #zoom_range=0.3,\n","                                        #brightness_range=[0.2,1.8],\n","                                        #channel_shift_range = 150,\n","                                        #shear_range = 0.7,\n","                                        horizontal_flip=True,\n","                                        vertical_flip=True, \n","                                        fill_mode='reflect',\n","                                        #cval=0,\n","                                        preprocessing_function = preprocess_input) # rescale value is multiplied to the image\n","\n","# Obtain a data generator with the 'ImageDataGenerator.flow_from_directory' method\n","aug_train_gen = aug_train_data_gen.flow_from_directory(directory=training_dir,\n","                                                       target_size=target_size,\n","                                                       color_mode='rgb',\n","                                                       classes=None, # can be set to labels\n","                                                       class_mode='categorical',\n","                                                       batch_size=batch_size,\n","                                                       shuffle=True,\n","                                                       seed=seed)\n","\n","valid_data_gen = ImageDataGenerator(preprocessing_function = preprocess_input)\n","\n","valid_gen = valid_data_gen.flow_from_directory(directory=validation_dir,\n","                                               target_size=target_size,\n","                                               color_mode='rgb',\n","                                               classes=None, # can be set to labels\n","                                               class_mode='categorical',\n","                                               batch_size=batch_size,\n","                                               shuffle=False,\n","                                               seed=seed)"]},{"cell_type":"markdown","metadata":{"id":"MWCDHpdzQMYZ"},"source":["# Fine Tuning"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"hgite22xR6S6"},"outputs":[],"source":["model1 = tf.keras.applications.resnet.ResNet101(weights = \"imagenet\", include_top=False, input_shape = (96, 96, 3))"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"DFGNSVe-SSrN"},"outputs":[],"source":["for layer in model1.layers[:5]:\n","    layer.trainable = False"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"TAm7FnNsSWp_"},"outputs":[],"source":["x = model1.output\n","x = tfkl.Flatten()(x)\n","x = tfkl.Dense(1024, activation=\"relu\")(x)\n","x = Dropout(0.5)(x)\n","x = tfkl.Dense(1024, activation=\"relu\")(x)\n","predictions = tfkl.Dense(8, activation=\"softmax\")(x) "]},{"cell_type":"code","execution_count":null,"metadata":{"id":"vUGDRFzKUA3d"},"outputs":[],"source":["from keras.models import Sequential, Model "]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":4368,"status":"ok","timestamp":1668900365961,"user":{"displayName":"Jana Khoury","userId":"07701165055658242759"},"user_tz":-60},"id":"iiFt05jtSbrR","outputId":"075575a4-3bc9-4d36-cac5-6bf464c5d10d"},"outputs":[{"name":"stdout","output_type":"stream","text":["Model: \"model\"\n","__________________________________________________________________________________________________\n"," Layer (type)                   Output Shape         Param #     Connected to                     \n","==================================================================================================\n"," input_1 (InputLayer)           [(None, 96, 96, 3)]  0           []                               \n","                                                                                                  \n"," conv1_pad (ZeroPadding2D)      (None, 102, 102, 3)  0           ['input_1[0][0]']                \n","                                                                                                  \n"," conv1_conv (Conv2D)            (None, 48, 48, 64)   9472        ['conv1_pad[0][0]']              \n","                                                                                                  \n"," conv1_bn (BatchNormalization)  (None, 48, 48, 64)   256         ['conv1_conv[0][0]']             \n","                                                                                                  \n"," conv1_relu (Activation)        (None, 48, 48, 64)   0           ['conv1_bn[0][0]']               \n","                                                                                                  \n"," pool1_pad (ZeroPadding2D)      (None, 50, 50, 64)   0           ['conv1_relu[0][0]']             \n","                                                                                                  \n"," pool1_pool (MaxPooling2D)      (None, 24, 24, 64)   0           ['pool1_pad[0][0]']              \n","                                                                                                  \n"," conv2_block1_1_conv (Conv2D)   (None, 24, 24, 64)   4160        ['pool1_pool[0][0]']             \n","                                                                                                  \n"," conv2_block1_1_bn (BatchNormal  (None, 24, 24, 64)  256         ['conv2_block1_1_conv[0][0]']    \n"," ization)                                                                                         \n","                                                                                                  \n"," conv2_block1_1_relu (Activatio  (None, 24, 24, 64)  0           ['conv2_block1_1_bn[0][0]']      \n"," n)                                                                                               \n","                                                                                                  \n"," conv2_block1_2_conv (Conv2D)   (None, 24, 24, 64)   36928       ['conv2_block1_1_relu[0][0]']    \n","                                                                                                  \n"," conv2_block1_2_bn (BatchNormal  (None, 24, 24, 64)  256         ['conv2_block1_2_conv[0][0]']    \n"," ization)                                                                                         \n","                                                                                                  \n"," conv2_block1_2_relu (Activatio  (None, 24, 24, 64)  0           ['conv2_block1_2_bn[0][0]']      \n"," n)                                                                                               \n","                                                                                                  \n"," conv2_block1_0_conv (Conv2D)   (None, 24, 24, 256)  16640       ['pool1_pool[0][0]']             \n","                                                                                                  \n"," conv2_block1_3_conv (Conv2D)   (None, 24, 24, 256)  16640       ['conv2_block1_2_relu[0][0]']    \n","                                                                                                  \n"," conv2_block1_0_bn (BatchNormal  (None, 24, 24, 256)  1024       ['conv2_block1_0_conv[0][0]']    \n"," ization)                                                                                         \n","                                                                                                  \n"," conv2_block1_3_bn (BatchNormal  (None, 24, 24, 256)  1024       ['conv2_block1_3_conv[0][0]']    \n"," ization)                                                                                         \n","                                                                                                  \n"," conv2_block1_add (Add)         (None, 24, 24, 256)  0           ['conv2_block1_0_bn[0][0]',      \n","                                                                  'conv2_block1_3_bn[0][0]']      \n","                                                                                                  \n"," conv2_block1_out (Activation)  (None, 24, 24, 256)  0           ['conv2_block1_add[0][0]']       \n","                                                                                                  \n"," conv2_block2_1_conv (Conv2D)   (None, 24, 24, 64)   16448       ['conv2_block1_out[0][0]']       \n","                                                                                                  \n"," conv2_block2_1_bn (BatchNormal  (None, 24, 24, 64)  256         ['conv2_block2_1_conv[0][0]']    \n"," ization)                                                                                         \n","                                                                                                  \n"," conv2_block2_1_relu (Activatio  (None, 24, 24, 64)  0           ['conv2_block2_1_bn[0][0]']      \n"," n)                                                                                               \n","                                                                                                  \n"," conv2_block2_2_conv (Conv2D)   (None, 24, 24, 64)   36928       ['conv2_block2_1_relu[0][0]']    \n","                                                                                                  \n"," conv2_block2_2_bn (BatchNormal  (None, 24, 24, 64)  256         ['conv2_block2_2_conv[0][0]']    \n"," ization)                                                                                         \n","                                                                                                  \n"," conv2_block2_2_relu (Activatio  (None, 24, 24, 64)  0           ['conv2_block2_2_bn[0][0]']      \n"," n)                                                                                               \n","                                                                                                  \n"," conv2_block2_3_conv (Conv2D)   (None, 24, 24, 256)  16640       ['conv2_block2_2_relu[0][0]']    \n","                                                                                                  \n"," conv2_block2_3_bn (BatchNormal  (None, 24, 24, 256)  1024       ['conv2_block2_3_conv[0][0]']    \n"," ization)                                                                                         \n","                                                                                                  \n"," conv2_block2_add (Add)         (None, 24, 24, 256)  0           ['conv2_block1_out[0][0]',       \n","                                                                  'conv2_block2_3_bn[0][0]']      \n","                                                                                                  \n"," conv2_block2_out (Activation)  (None, 24, 24, 256)  0           ['conv2_block2_add[0][0]']       \n","                                                                                                  \n"," conv2_block3_1_conv (Conv2D)   (None, 24, 24, 64)   16448       ['conv2_block2_out[0][0]']       \n","                                                                                                  \n"," conv2_block3_1_bn (BatchNormal  (None, 24, 24, 64)  256         ['conv2_block3_1_conv[0][0]']    \n"," ization)                                                                                         \n","                                                                                                  \n"," conv2_block3_1_relu (Activatio  (None, 24, 24, 64)  0           ['conv2_block3_1_bn[0][0]']      \n"," n)                                                                                               \n","                                                                                                  \n"," conv2_block3_2_conv (Conv2D)   (None, 24, 24, 64)   36928       ['conv2_block3_1_relu[0][0]']    \n"]},{"name":"stdout","output_type":"stream","text":["                                                                                                  \n"," conv2_block3_2_bn (BatchNormal  (None, 24, 24, 64)  256         ['conv2_block3_2_conv[0][0]']    \n"," ization)                                                                                         \n","                                                                                                  \n"," conv2_block3_2_relu (Activatio  (None, 24, 24, 64)  0           ['conv2_block3_2_bn[0][0]']      \n"," n)                                                                                               \n","                                                                                                  \n"," conv2_block3_3_conv (Conv2D)   (None, 24, 24, 256)  16640       ['conv2_block3_2_relu[0][0]']    \n","                                                                                                  \n"," conv2_block3_3_bn (BatchNormal  (None, 24, 24, 256)  1024       ['conv2_block3_3_conv[0][0]']    \n"," ization)                                                                                         \n","                                                                                                  \n"," conv2_block3_add (Add)         (None, 24, 24, 256)  0           ['conv2_block2_out[0][0]',       \n","                                                                  'conv2_block3_3_bn[0][0]']      \n","                                                                                                  \n"," conv2_block3_out (Activation)  (None, 24, 24, 256)  0           ['conv2_block3_add[0][0]']       \n","                                                                                                  \n"," conv3_block1_1_conv (Conv2D)   (None, 12, 12, 128)  32896       ['conv2_block3_out[0][0]']       \n","                                                                                                  \n"," conv3_block1_1_bn (BatchNormal  (None, 12, 12, 128)  512        ['conv3_block1_1_conv[0][0]']    \n"," ization)                                                                                         \n","                                                                                                  \n"," conv3_block1_1_relu (Activatio  (None, 12, 12, 128)  0          ['conv3_block1_1_bn[0][0]']      \n"," n)                                                                                               \n","                                                                                                  \n"," conv3_block1_2_conv (Conv2D)   (None, 12, 12, 128)  147584      ['conv3_block1_1_relu[0][0]']    \n","                                                                                                  \n"," conv3_block1_2_bn (BatchNormal  (None, 12, 12, 128)  512        ['conv3_block1_2_conv[0][0]']    \n"," ization)                                                                                         \n","                                                                                                  \n"," conv3_block1_2_relu (Activatio  (None, 12, 12, 128)  0          ['conv3_block1_2_bn[0][0]']      \n"," n)                                                                                               \n","                                                                                                  \n"," conv3_block1_0_conv (Conv2D)   (None, 12, 12, 512)  131584      ['conv2_block3_out[0][0]']       \n","                                                                                                  \n"," conv3_block1_3_conv (Conv2D)   (None, 12, 12, 512)  66048       ['conv3_block1_2_relu[0][0]']    \n","                                                                                                  \n"," conv3_block1_0_bn (BatchNormal  (None, 12, 12, 512)  2048       ['conv3_block1_0_conv[0][0]']    \n"," ization)                                                                                         \n","                                                                                                  \n"," conv3_block1_3_bn (BatchNormal  (None, 12, 12, 512)  2048       ['conv3_block1_3_conv[0][0]']    \n"," ization)                                                                                         \n","                                                                                                  \n"," conv3_block1_add (Add)         (None, 12, 12, 512)  0           ['conv3_block1_0_bn[0][0]',      \n","                                                                  'conv3_block1_3_bn[0][0]']      \n","                                                                                                  \n"," conv3_block1_out (Activation)  (None, 12, 12, 512)  0           ['conv3_block1_add[0][0]']       \n","                                                                                                  \n"," conv3_block2_1_conv (Conv2D)   (None, 12, 12, 128)  65664       ['conv3_block1_out[0][0]']       \n","                                                                                                  \n"," conv3_block2_1_bn (BatchNormal  (None, 12, 12, 128)  512        ['conv3_block2_1_conv[0][0]']    \n"," ization)                                                                                         \n","                                                                                                  \n"," conv3_block2_1_relu (Activatio  (None, 12, 12, 128)  0          ['conv3_block2_1_bn[0][0]']      \n"," n)                                                                                               \n","                                                                                                  \n"," conv3_block2_2_conv (Conv2D)   (None, 12, 12, 128)  147584      ['conv3_block2_1_relu[0][0]']    \n","                                                                                                  \n"," conv3_block2_2_bn (BatchNormal  (None, 12, 12, 128)  512        ['conv3_block2_2_conv[0][0]']    \n"," ization)                                                                                         \n","                                                                                                  \n"," conv3_block2_2_relu (Activatio  (None, 12, 12, 128)  0          ['conv3_block2_2_bn[0][0]']      \n"," n)                                                                                               \n","                                                                                                  \n"," conv3_block2_3_conv (Conv2D)   (None, 12, 12, 512)  66048       ['conv3_block2_2_relu[0][0]']    \n","                                                                                                  \n"," conv3_block2_3_bn (BatchNormal  (None, 12, 12, 512)  2048       ['conv3_block2_3_conv[0][0]']    \n"," ization)                                                                                         \n","                                                                                                  \n"," conv3_block2_add (Add)         (None, 12, 12, 512)  0           ['conv3_block1_out[0][0]',       \n","                                                                  'conv3_block2_3_bn[0][0]']      \n","                                                                                                  \n"," conv3_block2_out (Activation)  (None, 12, 12, 512)  0           ['conv3_block2_add[0][0]']       \n","                                                                                                  \n"," conv3_block3_1_conv (Conv2D)   (None, 12, 12, 128)  65664       ['conv3_block2_out[0][0]']       \n","                                                                                                  \n"," conv3_block3_1_bn (BatchNormal  (None, 12, 12, 128)  512        ['conv3_block3_1_conv[0][0]']    \n"," ization)                                                                                         \n","                                                                                                  \n"," conv3_block3_1_relu (Activatio  (None, 12, 12, 128)  0          ['conv3_block3_1_bn[0][0]']      \n"," n)                                                                                               \n","                                                                                                  \n"," conv3_block3_2_conv (Conv2D)   (None, 12, 12, 128)  147584      ['conv3_block3_1_relu[0][0]']    \n"]},{"name":"stdout","output_type":"stream","text":["                                                                                                  \n"," conv3_block3_2_bn (BatchNormal  (None, 12, 12, 128)  512        ['conv3_block3_2_conv[0][0]']    \n"," ization)                                                                                         \n","                                                                                                  \n"," conv3_block3_2_relu (Activatio  (None, 12, 12, 128)  0          ['conv3_block3_2_bn[0][0]']      \n"," n)                                                                                               \n","                                                                                                  \n"," conv3_block3_3_conv (Conv2D)   (None, 12, 12, 512)  66048       ['conv3_block3_2_relu[0][0]']    \n","                                                                                                  \n"," conv3_block3_3_bn (BatchNormal  (None, 12, 12, 512)  2048       ['conv3_block3_3_conv[0][0]']    \n"," ization)                                                                                         \n","                                                                                                  \n"," conv3_block3_add (Add)         (None, 12, 12, 512)  0           ['conv3_block2_out[0][0]',       \n","                                                                  'conv3_block3_3_bn[0][0]']      \n","                                                                                                  \n"," conv3_block3_out (Activation)  (None, 12, 12, 512)  0           ['conv3_block3_add[0][0]']       \n","                                                                                                  \n"," conv3_block4_1_conv (Conv2D)   (None, 12, 12, 128)  65664       ['conv3_block3_out[0][0]']       \n","                                                                                                  \n"," conv3_block4_1_bn (BatchNormal  (None, 12, 12, 128)  512        ['conv3_block4_1_conv[0][0]']    \n"," ization)                                                                                         \n","                                                                                                  \n"," conv3_block4_1_relu (Activatio  (None, 12, 12, 128)  0          ['conv3_block4_1_bn[0][0]']      \n"," n)                                                                                               \n","                                                                                                  \n"," conv3_block4_2_conv (Conv2D)   (None, 12, 12, 128)  147584      ['conv3_block4_1_relu[0][0]']    \n","                                                                                                  \n"," conv3_block4_2_bn (BatchNormal  (None, 12, 12, 128)  512        ['conv3_block4_2_conv[0][0]']    \n"," ization)                                                                                         \n","                                                                                                  \n"," conv3_block4_2_relu (Activatio  (None, 12, 12, 128)  0          ['conv3_block4_2_bn[0][0]']      \n"," n)                                                                                               \n","                                                                                                  \n"," conv3_block4_3_conv (Conv2D)   (None, 12, 12, 512)  66048       ['conv3_block4_2_relu[0][0]']    \n","                                                                                                  \n"," conv3_block4_3_bn (BatchNormal  (None, 12, 12, 512)  2048       ['conv3_block4_3_conv[0][0]']    \n"," ization)                                                                                         \n","                                                                                                  \n"," conv3_block4_add (Add)         (None, 12, 12, 512)  0           ['conv3_block3_out[0][0]',       \n","                                                                  'conv3_block4_3_bn[0][0]']      \n","                                                                                                  \n"," conv3_block4_out (Activation)  (None, 12, 12, 512)  0           ['conv3_block4_add[0][0]']       \n","                                                                                                  \n"," conv4_block1_1_conv (Conv2D)   (None, 6, 6, 256)    131328      ['conv3_block4_out[0][0]']       \n","                                                                                                  \n"," conv4_block1_1_bn (BatchNormal  (None, 6, 6, 256)   1024        ['conv4_block1_1_conv[0][0]']    \n"," ization)                                                                                         \n","                                                                                                  \n"," conv4_block1_1_relu (Activatio  (None, 6, 6, 256)   0           ['conv4_block1_1_bn[0][0]']      \n"," n)                                                                                               \n","                                                                                                  \n"," conv4_block1_2_conv (Conv2D)   (None, 6, 6, 256)    590080      ['conv4_block1_1_relu[0][0]']    \n","                                                                                                  \n"," conv4_block1_2_bn (BatchNormal  (None, 6, 6, 256)   1024        ['conv4_block1_2_conv[0][0]']    \n"," ization)                                                                                         \n","                                                                                                  \n"," conv4_block1_2_relu (Activatio  (None, 6, 6, 256)   0           ['conv4_block1_2_bn[0][0]']      \n"," n)                                                                                               \n","                                                                                                  \n"," conv4_block1_0_conv (Conv2D)   (None, 6, 6, 1024)   525312      ['conv3_block4_out[0][0]']       \n","                                                                                                  \n"," conv4_block1_3_conv (Conv2D)   (None, 6, 6, 1024)   263168      ['conv4_block1_2_relu[0][0]']    \n","                                                                                                  \n"," conv4_block1_0_bn (BatchNormal  (None, 6, 6, 1024)  4096        ['conv4_block1_0_conv[0][0]']    \n"," ization)                                                                                         \n","                                                                                                  \n"," conv4_block1_3_bn (BatchNormal  (None, 6, 6, 1024)  4096        ['conv4_block1_3_conv[0][0]']    \n"," ization)                                                                                         \n","                                                                                                  \n"," conv4_block1_add (Add)         (None, 6, 6, 1024)   0           ['conv4_block1_0_bn[0][0]',      \n","                                                                  'conv4_block1_3_bn[0][0]']      \n","                                                                                                  \n"," conv4_block1_out (Activation)  (None, 6, 6, 1024)   0           ['conv4_block1_add[0][0]']       \n","                                                                                                  \n"," conv4_block2_1_conv (Conv2D)   (None, 6, 6, 256)    262400      ['conv4_block1_out[0][0]']       \n","                                                                                                  \n"," conv4_block2_1_bn (BatchNormal  (None, 6, 6, 256)   1024        ['conv4_block2_1_conv[0][0]']    \n"," ization)                                                                                         \n","                                                                                                  \n"," conv4_block2_1_relu (Activatio  (None, 6, 6, 256)   0           ['conv4_block2_1_bn[0][0]']      \n"," n)                                                                                               \n","                                                                                                  \n"," conv4_block2_2_conv (Conv2D)   (None, 6, 6, 256)    590080      ['conv4_block2_1_relu[0][0]']    \n"]},{"name":"stdout","output_type":"stream","text":["                                                                                                  \n"," conv4_block2_2_bn (BatchNormal  (None, 6, 6, 256)   1024        ['conv4_block2_2_conv[0][0]']    \n"," ization)                                                                                         \n","                                                                                                  \n"," conv4_block2_2_relu (Activatio  (None, 6, 6, 256)   0           ['conv4_block2_2_bn[0][0]']      \n"," n)                                                                                               \n","                                                                                                  \n"," conv4_block2_3_conv (Conv2D)   (None, 6, 6, 1024)   263168      ['conv4_block2_2_relu[0][0]']    \n","                                                                                                  \n"," conv4_block2_3_bn (BatchNormal  (None, 6, 6, 1024)  4096        ['conv4_block2_3_conv[0][0]']    \n"," ization)                                                                                         \n","                                                                                                  \n"," conv4_block2_add (Add)         (None, 6, 6, 1024)   0           ['conv4_block1_out[0][0]',       \n","                                                                  'conv4_block2_3_bn[0][0]']      \n","                                                                                                  \n"," conv4_block2_out (Activation)  (None, 6, 6, 1024)   0           ['conv4_block2_add[0][0]']       \n","                                                                                                  \n"," conv4_block3_1_conv (Conv2D)   (None, 6, 6, 256)    262400      ['conv4_block2_out[0][0]']       \n","                                                                                                  \n"," conv4_block3_1_bn (BatchNormal  (None, 6, 6, 256)   1024        ['conv4_block3_1_conv[0][0]']    \n"," ization)                                                                                         \n","                                                                                                  \n"," conv4_block3_1_relu (Activatio  (None, 6, 6, 256)   0           ['conv4_block3_1_bn[0][0]']      \n"," n)                                                                                               \n","                                                                                                  \n"," conv4_block3_2_conv (Conv2D)   (None, 6, 6, 256)    590080      ['conv4_block3_1_relu[0][0]']    \n","                                                                                                  \n"," conv4_block3_2_bn (BatchNormal  (None, 6, 6, 256)   1024        ['conv4_block3_2_conv[0][0]']    \n"," ization)                                                                                         \n","                                                                                                  \n"," conv4_block3_2_relu (Activatio  (None, 6, 6, 256)   0           ['conv4_block3_2_bn[0][0]']      \n"," n)                                                                                               \n","                                                                                                  \n"," conv4_block3_3_conv (Conv2D)   (None, 6, 6, 1024)   263168      ['conv4_block3_2_relu[0][0]']    \n","                                                                                                  \n"," conv4_block3_3_bn (BatchNormal  (None, 6, 6, 1024)  4096        ['conv4_block3_3_conv[0][0]']    \n"," ization)                                                                                         \n","                                                                                                  \n"," conv4_block3_add (Add)         (None, 6, 6, 1024)   0           ['conv4_block2_out[0][0]',       \n","                                                                  'conv4_block3_3_bn[0][0]']      \n","                                                                                                  \n"," conv4_block3_out (Activation)  (None, 6, 6, 1024)   0           ['conv4_block3_add[0][0]']       \n","                                                                                                  \n"," conv4_block4_1_conv (Conv2D)   (None, 6, 6, 256)    262400      ['conv4_block3_out[0][0]']       \n","                                                                                                  \n"," conv4_block4_1_bn (BatchNormal  (None, 6, 6, 256)   1024        ['conv4_block4_1_conv[0][0]']    \n"," ization)                                                                                         \n","                                                                                                  \n"," conv4_block4_1_relu (Activatio  (None, 6, 6, 256)   0           ['conv4_block4_1_bn[0][0]']      \n"," n)                                                                                               \n","                                                                                                  \n"," conv4_block4_2_conv (Conv2D)   (None, 6, 6, 256)    590080      ['conv4_block4_1_relu[0][0]']    \n","                                                                                                  \n"," conv4_block4_2_bn (BatchNormal  (None, 6, 6, 256)   1024        ['conv4_block4_2_conv[0][0]']    \n"," ization)                                                                                         \n","                                                                                                  \n"," conv4_block4_2_relu (Activatio  (None, 6, 6, 256)   0           ['conv4_block4_2_bn[0][0]']      \n"," n)                                                                                               \n","                                                                                                  \n"," conv4_block4_3_conv (Conv2D)   (None, 6, 6, 1024)   263168      ['conv4_block4_2_relu[0][0]']    \n","                                                                                                  \n"," conv4_block4_3_bn (BatchNormal  (None, 6, 6, 1024)  4096        ['conv4_block4_3_conv[0][0]']    \n"," ization)                                                                                         \n","                                                                                                  \n"," conv4_block4_add (Add)         (None, 6, 6, 1024)   0           ['conv4_block3_out[0][0]',       \n","                                                                  'conv4_block4_3_bn[0][0]']      \n","                                                                                                  \n"," conv4_block4_out (Activation)  (None, 6, 6, 1024)   0           ['conv4_block4_add[0][0]']       \n","                                                                                                  \n"," conv4_block5_1_conv (Conv2D)   (None, 6, 6, 256)    262400      ['conv4_block4_out[0][0]']       \n","                                                                                                  \n"," conv4_block5_1_bn (BatchNormal  (None, 6, 6, 256)   1024        ['conv4_block5_1_conv[0][0]']    \n"," ization)                                                                                         \n","                                                                                                  \n"," conv4_block5_1_relu (Activatio  (None, 6, 6, 256)   0           ['conv4_block5_1_bn[0][0]']      \n"," n)                                                                                               \n","                                                                                                  \n"," conv4_block5_2_conv (Conv2D)   (None, 6, 6, 256)    590080      ['conv4_block5_1_relu[0][0]']    \n","                                                                                                  \n"," conv4_block5_2_bn (BatchNormal  (None, 6, 6, 256)   1024        ['conv4_block5_2_conv[0][0]']    \n"," ization)                                                                                         \n","                                                                                                  \n"," conv4_block5_2_relu (Activatio  (None, 6, 6, 256)   0           ['conv4_block5_2_bn[0][0]']      \n"]},{"name":"stdout","output_type":"stream","text":[" n)                                                                                               \n","                                                                                                  \n"," conv4_block5_3_conv (Conv2D)   (None, 6, 6, 1024)   263168      ['conv4_block5_2_relu[0][0]']    \n","                                                                                                  \n"," conv4_block5_3_bn (BatchNormal  (None, 6, 6, 1024)  4096        ['conv4_block5_3_conv[0][0]']    \n"," ization)                                                                                         \n","                                                                                                  \n"," conv4_block5_add (Add)         (None, 6, 6, 1024)   0           ['conv4_block4_out[0][0]',       \n","                                                                  'conv4_block5_3_bn[0][0]']      \n","                                                                                                  \n"," conv4_block5_out (Activation)  (None, 6, 6, 1024)   0           ['conv4_block5_add[0][0]']       \n","                                                                                                  \n"," conv4_block6_1_conv (Conv2D)   (None, 6, 6, 256)    262400      ['conv4_block5_out[0][0]']       \n","                                                                                                  \n"," conv4_block6_1_bn (BatchNormal  (None, 6, 6, 256)   1024        ['conv4_block6_1_conv[0][0]']    \n"," ization)                                                                                         \n","                                                                                                  \n"," conv4_block6_1_relu (Activatio  (None, 6, 6, 256)   0           ['conv4_block6_1_bn[0][0]']      \n"," n)                                                                                               \n","                                                                                                  \n"," conv4_block6_2_conv (Conv2D)   (None, 6, 6, 256)    590080      ['conv4_block6_1_relu[0][0]']    \n","                                                                                                  \n"," conv4_block6_2_bn (BatchNormal  (None, 6, 6, 256)   1024        ['conv4_block6_2_conv[0][0]']    \n"," ization)                                                                                         \n","                                                                                                  \n"," conv4_block6_2_relu (Activatio  (None, 6, 6, 256)   0           ['conv4_block6_2_bn[0][0]']      \n"," n)                                                                                               \n","                                                                                                  \n"," conv4_block6_3_conv (Conv2D)   (None, 6, 6, 1024)   263168      ['conv4_block6_2_relu[0][0]']    \n","                                                                                                  \n"," conv4_block6_3_bn (BatchNormal  (None, 6, 6, 1024)  4096        ['conv4_block6_3_conv[0][0]']    \n"," ization)                                                                                         \n","                                                                                                  \n"," conv4_block6_add (Add)         (None, 6, 6, 1024)   0           ['conv4_block5_out[0][0]',       \n","                                                                  'conv4_block6_3_bn[0][0]']      \n","                                                                                                  \n"," conv4_block6_out (Activation)  (None, 6, 6, 1024)   0           ['conv4_block6_add[0][0]']       \n","                                                                                                  \n"," conv4_block7_1_conv (Conv2D)   (None, 6, 6, 256)    262400      ['conv4_block6_out[0][0]']       \n","                                                                                                  \n"," conv4_block7_1_bn (BatchNormal  (None, 6, 6, 256)   1024        ['conv4_block7_1_conv[0][0]']    \n"," ization)                                                                                         \n","                                                                                                  \n"," conv4_block7_1_relu (Activatio  (None, 6, 6, 256)   0           ['conv4_block7_1_bn[0][0]']      \n"," n)                                                                                               \n","                                                                                                  \n"," conv4_block7_2_conv (Conv2D)   (None, 6, 6, 256)    590080      ['conv4_block7_1_relu[0][0]']    \n","                                                                                                  \n"," conv4_block7_2_bn (BatchNormal  (None, 6, 6, 256)   1024        ['conv4_block7_2_conv[0][0]']    \n"," ization)                                                                                         \n","                                                                                                  \n"," conv4_block7_2_relu (Activatio  (None, 6, 6, 256)   0           ['conv4_block7_2_bn[0][0]']      \n"," n)                                                                                               \n","                                                                                                  \n"," conv4_block7_3_conv (Conv2D)   (None, 6, 6, 1024)   263168      ['conv4_block7_2_relu[0][0]']    \n","                                                                                                  \n"," conv4_block7_3_bn (BatchNormal  (None, 6, 6, 1024)  4096        ['conv4_block7_3_conv[0][0]']    \n"," ization)                                                                                         \n","                                                                                                  \n"," conv4_block7_add (Add)         (None, 6, 6, 1024)   0           ['conv4_block6_out[0][0]',       \n","                                                                  'conv4_block7_3_bn[0][0]']      \n","                                                                                                  \n"," conv4_block7_out (Activation)  (None, 6, 6, 1024)   0           ['conv4_block7_add[0][0]']       \n","                                                                                                  \n"," conv4_block8_1_conv (Conv2D)   (None, 6, 6, 256)    262400      ['conv4_block7_out[0][0]']       \n","                                                                                                  \n"," conv4_block8_1_bn (BatchNormal  (None, 6, 6, 256)   1024        ['conv4_block8_1_conv[0][0]']    \n"," ization)                                                                                         \n","                                                                                                  \n"," conv4_block8_1_relu (Activatio  (None, 6, 6, 256)   0           ['conv4_block8_1_bn[0][0]']      \n"," n)                                                                                               \n","                                                                                                  \n"," conv4_block8_2_conv (Conv2D)   (None, 6, 6, 256)    590080      ['conv4_block8_1_relu[0][0]']    \n","                                                                                                  \n"," conv4_block8_2_bn (BatchNormal  (None, 6, 6, 256)   1024        ['conv4_block8_2_conv[0][0]']    \n"," ization)                                                                                         \n","                                                                                                  \n"," conv4_block8_2_relu (Activatio  (None, 6, 6, 256)   0           ['conv4_block8_2_bn[0][0]']      \n"," n)                                                                                               \n","                                                                                                  \n"," conv4_block8_3_conv (Conv2D)   (None, 6, 6, 1024)   263168      ['conv4_block8_2_relu[0][0]']    \n","                                                                                                  \n"," conv4_block8_3_bn (BatchNormal  (None, 6, 6, 1024)  4096        ['conv4_block8_3_conv[0][0]']    \n"]},{"name":"stdout","output_type":"stream","text":[" ization)                                                                                         \n","                                                                                                  \n"," conv4_block8_add (Add)         (None, 6, 6, 1024)   0           ['conv4_block7_out[0][0]',       \n","                                                                  'conv4_block8_3_bn[0][0]']      \n","                                                                                                  \n"," conv4_block8_out (Activation)  (None, 6, 6, 1024)   0           ['conv4_block8_add[0][0]']       \n","                                                                                                  \n"," conv4_block9_1_conv (Conv2D)   (None, 6, 6, 256)    262400      ['conv4_block8_out[0][0]']       \n","                                                                                                  \n"," conv4_block9_1_bn (BatchNormal  (None, 6, 6, 256)   1024        ['conv4_block9_1_conv[0][0]']    \n"," ization)                                                                                         \n","                                                                                                  \n"," conv4_block9_1_relu (Activatio  (None, 6, 6, 256)   0           ['conv4_block9_1_bn[0][0]']      \n"," n)                                                                                               \n","                                                                                                  \n"," conv4_block9_2_conv (Conv2D)   (None, 6, 6, 256)    590080      ['conv4_block9_1_relu[0][0]']    \n","                                                                                                  \n"," conv4_block9_2_bn (BatchNormal  (None, 6, 6, 256)   1024        ['conv4_block9_2_conv[0][0]']    \n"," ization)                                                                                         \n","                                                                                                  \n"," conv4_block9_2_relu (Activatio  (None, 6, 6, 256)   0           ['conv4_block9_2_bn[0][0]']      \n"," n)                                                                                               \n","                                                                                                  \n"," conv4_block9_3_conv (Conv2D)   (None, 6, 6, 1024)   263168      ['conv4_block9_2_relu[0][0]']    \n","                                                                                                  \n"," conv4_block9_3_bn (BatchNormal  (None, 6, 6, 1024)  4096        ['conv4_block9_3_conv[0][0]']    \n"," ization)                                                                                         \n","                                                                                                  \n"," conv4_block9_add (Add)         (None, 6, 6, 1024)   0           ['conv4_block8_out[0][0]',       \n","                                                                  'conv4_block9_3_bn[0][0]']      \n","                                                                                                  \n"," conv4_block9_out (Activation)  (None, 6, 6, 1024)   0           ['conv4_block9_add[0][0]']       \n","                                                                                                  \n"," conv4_block10_1_conv (Conv2D)  (None, 6, 6, 256)    262400      ['conv4_block9_out[0][0]']       \n","                                                                                                  \n"," conv4_block10_1_bn (BatchNorma  (None, 6, 6, 256)   1024        ['conv4_block10_1_conv[0][0]']   \n"," lization)                                                                                        \n","                                                                                                  \n"," conv4_block10_1_relu (Activati  (None, 6, 6, 256)   0           ['conv4_block10_1_bn[0][0]']     \n"," on)                                                                                              \n","                                                                                                  \n"," conv4_block10_2_conv (Conv2D)  (None, 6, 6, 256)    590080      ['conv4_block10_1_relu[0][0]']   \n","                                                                                                  \n"," conv4_block10_2_bn (BatchNorma  (None, 6, 6, 256)   1024        ['conv4_block10_2_conv[0][0]']   \n"," lization)                                                                                        \n","                                                                                                  \n"," conv4_block10_2_relu (Activati  (None, 6, 6, 256)   0           ['conv4_block10_2_bn[0][0]']     \n"," on)                                                                                              \n","                                                                                                  \n"," conv4_block10_3_conv (Conv2D)  (None, 6, 6, 1024)   263168      ['conv4_block10_2_relu[0][0]']   \n","                                                                                                  \n"," conv4_block10_3_bn (BatchNorma  (None, 6, 6, 1024)  4096        ['conv4_block10_3_conv[0][0]']   \n"," lization)                                                                                        \n","                                                                                                  \n"," conv4_block10_add (Add)        (None, 6, 6, 1024)   0           ['conv4_block9_out[0][0]',       \n","                                                                  'conv4_block10_3_bn[0][0]']     \n","                                                                                                  \n"," conv4_block10_out (Activation)  (None, 6, 6, 1024)  0           ['conv4_block10_add[0][0]']      \n","                                                                                                  \n"," conv4_block11_1_conv (Conv2D)  (None, 6, 6, 256)    262400      ['conv4_block10_out[0][0]']      \n","                                                                                                  \n"," conv4_block11_1_bn (BatchNorma  (None, 6, 6, 256)   1024        ['conv4_block11_1_conv[0][0]']   \n"," lization)                                                                                        \n","                                                                                                  \n"," conv4_block11_1_relu (Activati  (None, 6, 6, 256)   0           ['conv4_block11_1_bn[0][0]']     \n"," on)                                                                                              \n","                                                                                                  \n"," conv4_block11_2_conv (Conv2D)  (None, 6, 6, 256)    590080      ['conv4_block11_1_relu[0][0]']   \n","                                                                                                  \n"," conv4_block11_2_bn (BatchNorma  (None, 6, 6, 256)   1024        ['conv4_block11_2_conv[0][0]']   \n"," lization)                                                                                        \n","                                                                                                  \n"," conv4_block11_2_relu (Activati  (None, 6, 6, 256)   0           ['conv4_block11_2_bn[0][0]']     \n"," on)                                                                                              \n","                                                                                                  \n"," conv4_block11_3_conv (Conv2D)  (None, 6, 6, 1024)   263168      ['conv4_block11_2_relu[0][0]']   \n","                                                                                                  \n"," conv4_block11_3_bn (BatchNorma  (None, 6, 6, 1024)  4096        ['conv4_block11_3_conv[0][0]']   \n"," lization)                                                                                        \n","                                                                                                  \n"," conv4_block11_add (Add)        (None, 6, 6, 1024)   0           ['conv4_block10_out[0][0]',      \n","                                                                  'conv4_block11_3_bn[0][0]']     \n","                                                                                                  \n"]},{"name":"stdout","output_type":"stream","text":[" conv4_block11_out (Activation)  (None, 6, 6, 1024)  0           ['conv4_block11_add[0][0]']      \n","                                                                                                  \n"," conv4_block12_1_conv (Conv2D)  (None, 6, 6, 256)    262400      ['conv4_block11_out[0][0]']      \n","                                                                                                  \n"," conv4_block12_1_bn (BatchNorma  (None, 6, 6, 256)   1024        ['conv4_block12_1_conv[0][0]']   \n"," lization)                                                                                        \n","                                                                                                  \n"," conv4_block12_1_relu (Activati  (None, 6, 6, 256)   0           ['conv4_block12_1_bn[0][0]']     \n"," on)                                                                                              \n","                                                                                                  \n"," conv4_block12_2_conv (Conv2D)  (None, 6, 6, 256)    590080      ['conv4_block12_1_relu[0][0]']   \n","                                                                                                  \n"," conv4_block12_2_bn (BatchNorma  (None, 6, 6, 256)   1024        ['conv4_block12_2_conv[0][0]']   \n"," lization)                                                                                        \n","                                                                                                  \n"," conv4_block12_2_relu (Activati  (None, 6, 6, 256)   0           ['conv4_block12_2_bn[0][0]']     \n"," on)                                                                                              \n","                                                                                                  \n"," conv4_block12_3_conv (Conv2D)  (None, 6, 6, 1024)   263168      ['conv4_block12_2_relu[0][0]']   \n","                                                                                                  \n"," conv4_block12_3_bn (BatchNorma  (None, 6, 6, 1024)  4096        ['conv4_block12_3_conv[0][0]']   \n"," lization)                                                                                        \n","                                                                                                  \n"," conv4_block12_add (Add)        (None, 6, 6, 1024)   0           ['conv4_block11_out[0][0]',      \n","                                                                  'conv4_block12_3_bn[0][0]']     \n","                                                                                                  \n"," conv4_block12_out (Activation)  (None, 6, 6, 1024)  0           ['conv4_block12_add[0][0]']      \n","                                                                                                  \n"," conv4_block13_1_conv (Conv2D)  (None, 6, 6, 256)    262400      ['conv4_block12_out[0][0]']      \n","                                                                                                  \n"," conv4_block13_1_bn (BatchNorma  (None, 6, 6, 256)   1024        ['conv4_block13_1_conv[0][0]']   \n"," lization)                                                                                        \n","                                                                                                  \n"," conv4_block13_1_relu (Activati  (None, 6, 6, 256)   0           ['conv4_block13_1_bn[0][0]']     \n"," on)                                                                                              \n","                                                                                                  \n"," conv4_block13_2_conv (Conv2D)  (None, 6, 6, 256)    590080      ['conv4_block13_1_relu[0][0]']   \n","                                                                                                  \n"," conv4_block13_2_bn (BatchNorma  (None, 6, 6, 256)   1024        ['conv4_block13_2_conv[0][0]']   \n"," lization)                                                                                        \n","                                                                                                  \n"," conv4_block13_2_relu (Activati  (None, 6, 6, 256)   0           ['conv4_block13_2_bn[0][0]']     \n"," on)                                                                                              \n","                                                                                                  \n"," conv4_block13_3_conv (Conv2D)  (None, 6, 6, 1024)   263168      ['conv4_block13_2_relu[0][0]']   \n","                                                                                                  \n"," conv4_block13_3_bn (BatchNorma  (None, 6, 6, 1024)  4096        ['conv4_block13_3_conv[0][0]']   \n"," lization)                                                                                        \n","                                                                                                  \n"," conv4_block13_add (Add)        (None, 6, 6, 1024)   0           ['conv4_block12_out[0][0]',      \n","                                                                  'conv4_block13_3_bn[0][0]']     \n","                                                                                                  \n"," conv4_block13_out (Activation)  (None, 6, 6, 1024)  0           ['conv4_block13_add[0][0]']      \n","                                                                                                  \n"," conv4_block14_1_conv (Conv2D)  (None, 6, 6, 256)    262400      ['conv4_block13_out[0][0]']      \n","                                                                                                  \n"," conv4_block14_1_bn (BatchNorma  (None, 6, 6, 256)   1024        ['conv4_block14_1_conv[0][0]']   \n"," lization)                                                                                        \n","                                                                                                  \n"," conv4_block14_1_relu (Activati  (None, 6, 6, 256)   0           ['conv4_block14_1_bn[0][0]']     \n"," on)                                                                                              \n","                                                                                                  \n"," conv4_block14_2_conv (Conv2D)  (None, 6, 6, 256)    590080      ['conv4_block14_1_relu[0][0]']   \n","                                                                                                  \n"," conv4_block14_2_bn (BatchNorma  (None, 6, 6, 256)   1024        ['conv4_block14_2_conv[0][0]']   \n"," lization)                                                                                        \n","                                                                                                  \n"," conv4_block14_2_relu (Activati  (None, 6, 6, 256)   0           ['conv4_block14_2_bn[0][0]']     \n"," on)                                                                                              \n","                                                                                                  \n"," conv4_block14_3_conv (Conv2D)  (None, 6, 6, 1024)   263168      ['conv4_block14_2_relu[0][0]']   \n","                                                                                                  \n"," conv4_block14_3_bn (BatchNorma  (None, 6, 6, 1024)  4096        ['conv4_block14_3_conv[0][0]']   \n"," lization)                                                                                        \n","                                                                                                  \n"," conv4_block14_add (Add)        (None, 6, 6, 1024)   0           ['conv4_block13_out[0][0]',      \n","                                                                  'conv4_block14_3_bn[0][0]']     \n","                                                                                                  \n"," conv4_block14_out (Activation)  (None, 6, 6, 1024)  0           ['conv4_block14_add[0][0]']      \n","                                                                                                  \n"," conv4_block15_1_conv (Conv2D)  (None, 6, 6, 256)    262400      ['conv4_block14_out[0][0]']      \n","                                                                                                  \n"," conv4_block15_1_bn (BatchNorma  (None, 6, 6, 256)   1024        ['conv4_block15_1_conv[0][0]']   \n"]},{"name":"stdout","output_type":"stream","text":[" lization)                                                                                        \n","                                                                                                  \n"," conv4_block15_1_relu (Activati  (None, 6, 6, 256)   0           ['conv4_block15_1_bn[0][0]']     \n"," on)                                                                                              \n","                                                                                                  \n"," conv4_block15_2_conv (Conv2D)  (None, 6, 6, 256)    590080      ['conv4_block15_1_relu[0][0]']   \n","                                                                                                  \n"," conv4_block15_2_bn (BatchNorma  (None, 6, 6, 256)   1024        ['conv4_block15_2_conv[0][0]']   \n"," lization)                                                                                        \n","                                                                                                  \n"," conv4_block15_2_relu (Activati  (None, 6, 6, 256)   0           ['conv4_block15_2_bn[0][0]']     \n"," on)                                                                                              \n","                                                                                                  \n"," conv4_block15_3_conv (Conv2D)  (None, 6, 6, 1024)   263168      ['conv4_block15_2_relu[0][0]']   \n","                                                                                                  \n"," conv4_block15_3_bn (BatchNorma  (None, 6, 6, 1024)  4096        ['conv4_block15_3_conv[0][0]']   \n"," lization)                                                                                        \n","                                                                                                  \n"," conv4_block15_add (Add)        (None, 6, 6, 1024)   0           ['conv4_block14_out[0][0]',      \n","                                                                  'conv4_block15_3_bn[0][0]']     \n","                                                                                                  \n"," conv4_block15_out (Activation)  (None, 6, 6, 1024)  0           ['conv4_block15_add[0][0]']      \n","                                                                                                  \n"," conv4_block16_1_conv (Conv2D)  (None, 6, 6, 256)    262400      ['conv4_block15_out[0][0]']      \n","                                                                                                  \n"," conv4_block16_1_bn (BatchNorma  (None, 6, 6, 256)   1024        ['conv4_block16_1_conv[0][0]']   \n"," lization)                                                                                        \n","                                                                                                  \n"," conv4_block16_1_relu (Activati  (None, 6, 6, 256)   0           ['conv4_block16_1_bn[0][0]']     \n"," on)                                                                                              \n","                                                                                                  \n"," conv4_block16_2_conv (Conv2D)  (None, 6, 6, 256)    590080      ['conv4_block16_1_relu[0][0]']   \n","                                                                                                  \n"," conv4_block16_2_bn (BatchNorma  (None, 6, 6, 256)   1024        ['conv4_block16_2_conv[0][0]']   \n"," lization)                                                                                        \n","                                                                                                  \n"," conv4_block16_2_relu (Activati  (None, 6, 6, 256)   0           ['conv4_block16_2_bn[0][0]']     \n"," on)                                                                                              \n","                                                                                                  \n"," conv4_block16_3_conv (Conv2D)  (None, 6, 6, 1024)   263168      ['conv4_block16_2_relu[0][0]']   \n","                                                                                                  \n"," conv4_block16_3_bn (BatchNorma  (None, 6, 6, 1024)  4096        ['conv4_block16_3_conv[0][0]']   \n"," lization)                                                                                        \n","                                                                                                  \n"," conv4_block16_add (Add)        (None, 6, 6, 1024)   0           ['conv4_block15_out[0][0]',      \n","                                                                  'conv4_block16_3_bn[0][0]']     \n","                                                                                                  \n"," conv4_block16_out (Activation)  (None, 6, 6, 1024)  0           ['conv4_block16_add[0][0]']      \n","                                                                                                  \n"," conv4_block17_1_conv (Conv2D)  (None, 6, 6, 256)    262400      ['conv4_block16_out[0][0]']      \n","                                                                                                  \n"," conv4_block17_1_bn (BatchNorma  (None, 6, 6, 256)   1024        ['conv4_block17_1_conv[0][0]']   \n"," lization)                                                                                        \n","                                                                                                  \n"," conv4_block17_1_relu (Activati  (None, 6, 6, 256)   0           ['conv4_block17_1_bn[0][0]']     \n"," on)                                                                                              \n","                                                                                                  \n"," conv4_block17_2_conv (Conv2D)  (None, 6, 6, 256)    590080      ['conv4_block17_1_relu[0][0]']   \n","                                                                                                  \n"," conv4_block17_2_bn (BatchNorma  (None, 6, 6, 256)   1024        ['conv4_block17_2_conv[0][0]']   \n"," lization)                                                                                        \n","                                                                                                  \n"," conv4_block17_2_relu (Activati  (None, 6, 6, 256)   0           ['conv4_block17_2_bn[0][0]']     \n"," on)                                                                                              \n","                                                                                                  \n"," conv4_block17_3_conv (Conv2D)  (None, 6, 6, 1024)   263168      ['conv4_block17_2_relu[0][0]']   \n","                                                                                                  \n"," conv4_block17_3_bn (BatchNorma  (None, 6, 6, 1024)  4096        ['conv4_block17_3_conv[0][0]']   \n"," lization)                                                                                        \n","                                                                                                  \n"," conv4_block17_add (Add)        (None, 6, 6, 1024)   0           ['conv4_block16_out[0][0]',      \n","                                                                  'conv4_block17_3_bn[0][0]']     \n","                                                                                                  \n"," conv4_block17_out (Activation)  (None, 6, 6, 1024)  0           ['conv4_block17_add[0][0]']      \n","                                                                                                  \n"," conv4_block18_1_conv (Conv2D)  (None, 6, 6, 256)    262400      ['conv4_block17_out[0][0]']      \n","                                                                                                  \n"," conv4_block18_1_bn (BatchNorma  (None, 6, 6, 256)   1024        ['conv4_block18_1_conv[0][0]']   \n"," lization)                                                                                        \n","                                                                                                  \n"," conv4_block18_1_relu (Activati  (None, 6, 6, 256)   0           ['conv4_block18_1_bn[0][0]']     \n"," on)                                                                                              \n","                                                                                                  \n"]},{"name":"stdout","output_type":"stream","text":[" conv4_block18_2_conv (Conv2D)  (None, 6, 6, 256)    590080      ['conv4_block18_1_relu[0][0]']   \n","                                                                                                  \n"," conv4_block18_2_bn (BatchNorma  (None, 6, 6, 256)   1024        ['conv4_block18_2_conv[0][0]']   \n"," lization)                                                                                        \n","                                                                                                  \n"," conv4_block18_2_relu (Activati  (None, 6, 6, 256)   0           ['conv4_block18_2_bn[0][0]']     \n"," on)                                                                                              \n","                                                                                                  \n"," conv4_block18_3_conv (Conv2D)  (None, 6, 6, 1024)   263168      ['conv4_block18_2_relu[0][0]']   \n","                                                                                                  \n"," conv4_block18_3_bn (BatchNorma  (None, 6, 6, 1024)  4096        ['conv4_block18_3_conv[0][0]']   \n"," lization)                                                                                        \n","                                                                                                  \n"," conv4_block18_add (Add)        (None, 6, 6, 1024)   0           ['conv4_block17_out[0][0]',      \n","                                                                  'conv4_block18_3_bn[0][0]']     \n","                                                                                                  \n"," conv4_block18_out (Activation)  (None, 6, 6, 1024)  0           ['conv4_block18_add[0][0]']      \n","                                                                                                  \n"," conv4_block19_1_conv (Conv2D)  (None, 6, 6, 256)    262400      ['conv4_block18_out[0][0]']      \n","                                                                                                  \n"," conv4_block19_1_bn (BatchNorma  (None, 6, 6, 256)   1024        ['conv4_block19_1_conv[0][0]']   \n"," lization)                                                                                        \n","                                                                                                  \n"," conv4_block19_1_relu (Activati  (None, 6, 6, 256)   0           ['conv4_block19_1_bn[0][0]']     \n"," on)                                                                                              \n","                                                                                                  \n"," conv4_block19_2_conv (Conv2D)  (None, 6, 6, 256)    590080      ['conv4_block19_1_relu[0][0]']   \n","                                                                                                  \n"," conv4_block19_2_bn (BatchNorma  (None, 6, 6, 256)   1024        ['conv4_block19_2_conv[0][0]']   \n"," lization)                                                                                        \n","                                                                                                  \n"," conv4_block19_2_relu (Activati  (None, 6, 6, 256)   0           ['conv4_block19_2_bn[0][0]']     \n"," on)                                                                                              \n","                                                                                                  \n"," conv4_block19_3_conv (Conv2D)  (None, 6, 6, 1024)   263168      ['conv4_block19_2_relu[0][0]']   \n","                                                                                                  \n"," conv4_block19_3_bn (BatchNorma  (None, 6, 6, 1024)  4096        ['conv4_block19_3_conv[0][0]']   \n"," lization)                                                                                        \n","                                                                                                  \n"," conv4_block19_add (Add)        (None, 6, 6, 1024)   0           ['conv4_block18_out[0][0]',      \n","                                                                  'conv4_block19_3_bn[0][0]']     \n","                                                                                                  \n"," conv4_block19_out (Activation)  (None, 6, 6, 1024)  0           ['conv4_block19_add[0][0]']      \n","                                                                                                  \n"," conv4_block20_1_conv (Conv2D)  (None, 6, 6, 256)    262400      ['conv4_block19_out[0][0]']      \n","                                                                                                  \n"," conv4_block20_1_bn (BatchNorma  (None, 6, 6, 256)   1024        ['conv4_block20_1_conv[0][0]']   \n"," lization)                                                                                        \n","                                                                                                  \n"," conv4_block20_1_relu (Activati  (None, 6, 6, 256)   0           ['conv4_block20_1_bn[0][0]']     \n"," on)                                                                                              \n","                                                                                                  \n"," conv4_block20_2_conv (Conv2D)  (None, 6, 6, 256)    590080      ['conv4_block20_1_relu[0][0]']   \n","                                                                                                  \n"," conv4_block20_2_bn (BatchNorma  (None, 6, 6, 256)   1024        ['conv4_block20_2_conv[0][0]']   \n"," lization)                                                                                        \n","                                                                                                  \n"," conv4_block20_2_relu (Activati  (None, 6, 6, 256)   0           ['conv4_block20_2_bn[0][0]']     \n"," on)                                                                                              \n","                                                                                                  \n"," conv4_block20_3_conv (Conv2D)  (None, 6, 6, 1024)   263168      ['conv4_block20_2_relu[0][0]']   \n","                                                                                                  \n"," conv4_block20_3_bn (BatchNorma  (None, 6, 6, 1024)  4096        ['conv4_block20_3_conv[0][0]']   \n"," lization)                                                                                        \n","                                                                                                  \n"," conv4_block20_add (Add)        (None, 6, 6, 1024)   0           ['conv4_block19_out[0][0]',      \n","                                                                  'conv4_block20_3_bn[0][0]']     \n","                                                                                                  \n"," conv4_block20_out (Activation)  (None, 6, 6, 1024)  0           ['conv4_block20_add[0][0]']      \n","                                                                                                  \n"," conv4_block21_1_conv (Conv2D)  (None, 6, 6, 256)    262400      ['conv4_block20_out[0][0]']      \n","                                                                                                  \n"," conv4_block21_1_bn (BatchNorma  (None, 6, 6, 256)   1024        ['conv4_block21_1_conv[0][0]']   \n"," lization)                                                                                        \n","                                                                                                  \n"," conv4_block21_1_relu (Activati  (None, 6, 6, 256)   0           ['conv4_block21_1_bn[0][0]']     \n"," on)                                                                                              \n","                                                                                                  \n"," conv4_block21_2_conv (Conv2D)  (None, 6, 6, 256)    590080      ['conv4_block21_1_relu[0][0]']   \n","                                                                                                  \n"," conv4_block21_2_bn (BatchNorma  (None, 6, 6, 256)   1024        ['conv4_block21_2_conv[0][0]']   \n"," lization)                                                                                        \n","                                                                                                  \n"]},{"name":"stdout","output_type":"stream","text":[" conv4_block21_2_relu (Activati  (None, 6, 6, 256)   0           ['conv4_block21_2_bn[0][0]']     \n"," on)                                                                                              \n","                                                                                                  \n"," conv4_block21_3_conv (Conv2D)  (None, 6, 6, 1024)   263168      ['conv4_block21_2_relu[0][0]']   \n","                                                                                                  \n"," conv4_block21_3_bn (BatchNorma  (None, 6, 6, 1024)  4096        ['conv4_block21_3_conv[0][0]']   \n"," lization)                                                                                        \n","                                                                                                  \n"," conv4_block21_add (Add)        (None, 6, 6, 1024)   0           ['conv4_block20_out[0][0]',      \n","                                                                  'conv4_block21_3_bn[0][0]']     \n","                                                                                                  \n"," conv4_block21_out (Activation)  (None, 6, 6, 1024)  0           ['conv4_block21_add[0][0]']      \n","                                                                                                  \n"," conv4_block22_1_conv (Conv2D)  (None, 6, 6, 256)    262400      ['conv4_block21_out[0][0]']      \n","                                                                                                  \n"," conv4_block22_1_bn (BatchNorma  (None, 6, 6, 256)   1024        ['conv4_block22_1_conv[0][0]']   \n"," lization)                                                                                        \n","                                                                                                  \n"," conv4_block22_1_relu (Activati  (None, 6, 6, 256)   0           ['conv4_block22_1_bn[0][0]']     \n"," on)                                                                                              \n","                                                                                                  \n"," conv4_block22_2_conv (Conv2D)  (None, 6, 6, 256)    590080      ['conv4_block22_1_relu[0][0]']   \n","                                                                                                  \n"," conv4_block22_2_bn (BatchNorma  (None, 6, 6, 256)   1024        ['conv4_block22_2_conv[0][0]']   \n"," lization)                                                                                        \n","                                                                                                  \n"," conv4_block22_2_relu (Activati  (None, 6, 6, 256)   0           ['conv4_block22_2_bn[0][0]']     \n"," on)                                                                                              \n","                                                                                                  \n"," conv4_block22_3_conv (Conv2D)  (None, 6, 6, 1024)   263168      ['conv4_block22_2_relu[0][0]']   \n","                                                                                                  \n"," conv4_block22_3_bn (BatchNorma  (None, 6, 6, 1024)  4096        ['conv4_block22_3_conv[0][0]']   \n"," lization)                                                                                        \n","                                                                                                  \n"," conv4_block22_add (Add)        (None, 6, 6, 1024)   0           ['conv4_block21_out[0][0]',      \n","                                                                  'conv4_block22_3_bn[0][0]']     \n","                                                                                                  \n"," conv4_block22_out (Activation)  (None, 6, 6, 1024)  0           ['conv4_block22_add[0][0]']      \n","                                                                                                  \n"," conv4_block23_1_conv (Conv2D)  (None, 6, 6, 256)    262400      ['conv4_block22_out[0][0]']      \n","                                                                                                  \n"," conv4_block23_1_bn (BatchNorma  (None, 6, 6, 256)   1024        ['conv4_block23_1_conv[0][0]']   \n"," lization)                                                                                        \n","                                                                                                  \n"," conv4_block23_1_relu (Activati  (None, 6, 6, 256)   0           ['conv4_block23_1_bn[0][0]']     \n"," on)                                                                                              \n","                                                                                                  \n"," conv4_block23_2_conv (Conv2D)  (None, 6, 6, 256)    590080      ['conv4_block23_1_relu[0][0]']   \n","                                                                                                  \n"," conv4_block23_2_bn (BatchNorma  (None, 6, 6, 256)   1024        ['conv4_block23_2_conv[0][0]']   \n"," lization)                                                                                        \n","                                                                                                  \n"," conv4_block23_2_relu (Activati  (None, 6, 6, 256)   0           ['conv4_block23_2_bn[0][0]']     \n"," on)                                                                                              \n","                                                                                                  \n"," conv4_block23_3_conv (Conv2D)  (None, 6, 6, 1024)   263168      ['conv4_block23_2_relu[0][0]']   \n","                                                                                                  \n"," conv4_block23_3_bn (BatchNorma  (None, 6, 6, 1024)  4096        ['conv4_block23_3_conv[0][0]']   \n"," lization)                                                                                        \n","                                                                                                  \n"," conv4_block23_add (Add)        (None, 6, 6, 1024)   0           ['conv4_block22_out[0][0]',      \n","                                                                  'conv4_block23_3_bn[0][0]']     \n","                                                                                                  \n"," conv4_block23_out (Activation)  (None, 6, 6, 1024)  0           ['conv4_block23_add[0][0]']      \n","                                                                                                  \n"," conv5_block1_1_conv (Conv2D)   (None, 3, 3, 512)    524800      ['conv4_block23_out[0][0]']      \n","                                                                                                  \n"," conv5_block1_1_bn (BatchNormal  (None, 3, 3, 512)   2048        ['conv5_block1_1_conv[0][0]']    \n"," ization)                                                                                         \n","                                                                                                  \n"," conv5_block1_1_relu (Activatio  (None, 3, 3, 512)   0           ['conv5_block1_1_bn[0][0]']      \n"," n)                                                                                               \n","                                                                                                  \n"," conv5_block1_2_conv (Conv2D)   (None, 3, 3, 512)    2359808     ['conv5_block1_1_relu[0][0]']    \n","                                                                                                  \n"," conv5_block1_2_bn (BatchNormal  (None, 3, 3, 512)   2048        ['conv5_block1_2_conv[0][0]']    \n"," ization)                                                                                         \n","                                                                                                  \n"," conv5_block1_2_relu (Activatio  (None, 3, 3, 512)   0           ['conv5_block1_2_bn[0][0]']      \n"," n)                                                                                               \n","                                                                                                  \n"," conv5_block1_0_conv (Conv2D)   (None, 3, 3, 2048)   2099200     ['conv4_block23_out[0][0]']      \n","                                                                                                  \n"]},{"name":"stdout","output_type":"stream","text":[" conv5_block1_3_conv (Conv2D)   (None, 3, 3, 2048)   1050624     ['conv5_block1_2_relu[0][0]']    \n","                                                                                                  \n"," conv5_block1_0_bn (BatchNormal  (None, 3, 3, 2048)  8192        ['conv5_block1_0_conv[0][0]']    \n"," ization)                                                                                         \n","                                                                                                  \n"," conv5_block1_3_bn (BatchNormal  (None, 3, 3, 2048)  8192        ['conv5_block1_3_conv[0][0]']    \n"," ization)                                                                                         \n","                                                                                                  \n"," conv5_block1_add (Add)         (None, 3, 3, 2048)   0           ['conv5_block1_0_bn[0][0]',      \n","                                                                  'conv5_block1_3_bn[0][0]']      \n","                                                                                                  \n"," conv5_block1_out (Activation)  (None, 3, 3, 2048)   0           ['conv5_block1_add[0][0]']       \n","                                                                                                  \n"," conv5_block2_1_conv (Conv2D)   (None, 3, 3, 512)    1049088     ['conv5_block1_out[0][0]']       \n","                                                                                                  \n"," conv5_block2_1_bn (BatchNormal  (None, 3, 3, 512)   2048        ['conv5_block2_1_conv[0][0]']    \n"," ization)                                                                                         \n","                                                                                                  \n"," conv5_block2_1_relu (Activatio  (None, 3, 3, 512)   0           ['conv5_block2_1_bn[0][0]']      \n"," n)                                                                                               \n","                                                                                                  \n"," conv5_block2_2_conv (Conv2D)   (None, 3, 3, 512)    2359808     ['conv5_block2_1_relu[0][0]']    \n","                                                                                                  \n"," conv5_block2_2_bn (BatchNormal  (None, 3, 3, 512)   2048        ['conv5_block2_2_conv[0][0]']    \n"," ization)                                                                                         \n","                                                                                                  \n"," conv5_block2_2_relu (Activatio  (None, 3, 3, 512)   0           ['conv5_block2_2_bn[0][0]']      \n"," n)                                                                                               \n","                                                                                                  \n"," conv5_block2_3_conv (Conv2D)   (None, 3, 3, 2048)   1050624     ['conv5_block2_2_relu[0][0]']    \n","                                                                                                  \n"," conv5_block2_3_bn (BatchNormal  (None, 3, 3, 2048)  8192        ['conv5_block2_3_conv[0][0]']    \n"," ization)                                                                                         \n","                                                                                                  \n"," conv5_block2_add (Add)         (None, 3, 3, 2048)   0           ['conv5_block1_out[0][0]',       \n","                                                                  'conv5_block2_3_bn[0][0]']      \n","                                                                                                  \n"," conv5_block2_out (Activation)  (None, 3, 3, 2048)   0           ['conv5_block2_add[0][0]']       \n","                                                                                                  \n"," conv5_block3_1_conv (Conv2D)   (None, 3, 3, 512)    1049088     ['conv5_block2_out[0][0]']       \n","                                                                                                  \n"," conv5_block3_1_bn (BatchNormal  (None, 3, 3, 512)   2048        ['conv5_block3_1_conv[0][0]']    \n"," ization)                                                                                         \n","                                                                                                  \n"," conv5_block3_1_relu (Activatio  (None, 3, 3, 512)   0           ['conv5_block3_1_bn[0][0]']      \n"," n)                                                                                               \n","                                                                                                  \n"," conv5_block3_2_conv (Conv2D)   (None, 3, 3, 512)    2359808     ['conv5_block3_1_relu[0][0]']    \n","                                                                                                  \n"," conv5_block3_2_bn (BatchNormal  (None, 3, 3, 512)   2048        ['conv5_block3_2_conv[0][0]']    \n"," ization)                                                                                         \n","                                                                                                  \n"," conv5_block3_2_relu (Activatio  (None, 3, 3, 512)   0           ['conv5_block3_2_bn[0][0]']      \n"," n)                                                                                               \n","                                                                                                  \n"," conv5_block3_3_conv (Conv2D)   (None, 3, 3, 2048)   1050624     ['conv5_block3_2_relu[0][0]']    \n","                                                                                                  \n"," conv5_block3_3_bn (BatchNormal  (None, 3, 3, 2048)  8192        ['conv5_block3_3_conv[0][0]']    \n"," ization)                                                                                         \n","                                                                                                  \n"," conv5_block3_add (Add)         (None, 3, 3, 2048)   0           ['conv5_block2_out[0][0]',       \n","                                                                  'conv5_block3_3_bn[0][0]']      \n","                                                                                                  \n"," conv5_block3_out (Activation)  (None, 3, 3, 2048)   0           ['conv5_block3_add[0][0]']       \n","                                                                                                  \n"," flatten (Flatten)              (None, 18432)        0           ['conv5_block3_out[0][0]']       \n","                                                                                                  \n"," dense (Dense)                  (None, 1024)         18875392    ['flatten[0][0]']                \n","                                                                                                  \n"," dropout (Dropout)              (None, 1024)         0           ['dense[0][0]']                  \n","                                                                                                  \n"," dense_1 (Dense)                (None, 1024)         1049600     ['dropout[0][0]']                \n","                                                                                                  \n"," dense_2 (Dense)                (None, 8)            8200        ['dense_1[0][0]']                \n","                                                                                                  \n","==================================================================================================\n","Total params: 62,591,368\n","Trainable params: 62,476,424\n","Non-trainable params: 114,944\n","__________________________________________________________________________________________________\n"]}],"source":["model_final = Model(model1.input, predictions)\n","\n","#compling our model\n","model_final.compile(loss=tfk.losses.CategoricalCrossentropy(), optimizer=tfk.optimizers.SGD(learning_rate=0.0001, momentum=0.9), metrics='accuracy')\n","\n","model_final.summary() #Model summary"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"4ID9_hipShPE"},"outputs":[],"source":["# Utility function to create folders and callbacks for training\n","from datetime import datetime\n","\n","def create_folders_and_callbacks1(model_name):\n","    \n","\n","    cwd = os.getcwd()\n","\n","    exps_dir = os.path.join(cwd, 'classification_experiments')\n","    if not os.path.exists(exps_dir):\n","        os.makedirs(exps_dir)\n","\n","    now = datetime.now().strftime('%b%d_%H-%M-%S')\n","\n","    model_name = 'resnet101'\n","\n","    exp_dir = os.path.join(exps_dir, model_name + '_' + str(now))\n","    if not os.path.exists(exp_dir):\n","        os.makedirs(exp_dir)\n","      \n","    callbacks = []\n","\n","    # Model checkpoint\n","    # ----------------\n","\n","    ckpt_dir = os.path.join(exp_dir, 'ckpts')\n","    if not os.path.exists(ckpt_dir):\n","        os.makedirs(ckpt_dir)\n","\n","    ckpt_callback = tf.keras.callbacks.ModelCheckpoint(filepath=os.path.join(ckpt_dir, 'cp_class_{epoch:02d}.ckpt'),\n","                                                       save_weights_only=True)  # False to save the model directly\n","    callbacks.append(ckpt_callback)\n","\n","    # Visualize Learning on Tensorboard\n","    # ---------------------------------\n","    tb_dir = os.path.join(exp_dir, 'tb_logs')\n","    if not os.path.exists(tb_dir):\n","        os.makedirs(tb_dir)\n","    \n","    # By default shows losses and metrics for both training and validation\n","    tb_callback = tf.keras.callbacks.TensorBoard(log_dir=tb_dir,\n","                                                 profile_batch=0,\n","                                                 histogram_freq=1)  # if 1 shows weights histograms\n","    callbacks.append(ckpt_callback)\n","\n","\n","    # Early Stopping\n","    # --------------\n","    early_stop = True\n","    if early_stop:\n","        es_callback = tf.keras.callbacks.EarlyStopping(monitor='val_accuracy', mode='max', patience=10)\n","        callbacks.append(es_callback)\n","        \n","\n","    return callbacks"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"base_uri":"https://localhost:8080/","height":392},"executionInfo":{"elapsed":58505,"status":"error","timestamp":1668900438676,"user":{"displayName":"Jana Khoury","userId":"07701165055658242759"},"user_tz":-60},"id":"BYn0IA9CSiP4","outputId":"ad89579d-19e0-4a2a-c6a5-b3c349f98e17"},"outputs":[{"name":"stdout","output_type":"stream","text":["Epoch 1/100\n","61/61 [==============================] - 43s 478ms/step - loss: 2.6696 - accuracy: 0.1612 - val_loss: 1.9678 - val_accuracy: 0.2450\n","Epoch 2/100\n","61/61 [==============================] - 27s 437ms/step - loss: 2.1240 - accuracy: 0.2718 - val_loss: 1.7055 - val_accuracy: 0.3500\n","Epoch 3/100\n","61/61 [==============================] - 26s 432ms/step - loss: 1.8772 - accuracy: 0.3373 - val_loss: 1.5574 - val_accuracy: 0.4350\n","Epoch 4/100\n","61/61 [==============================] - 28s 461ms/step - loss: 1.6467 - accuracy: 0.4109 - val_loss: 1.4184 - val_accuracy: 0.5125\n","Epoch 5/100\n","61/61 [==============================] - 29s 469ms/step - loss: 1.5202 - accuracy: 0.4623 - val_loss: 1.4162 - val_accuracy: 0.5400\n","Epoch 6/100\n","61/61 [==============================] - 34s 565ms/step - loss: 1.3994 - accuracy: 0.4951 - val_loss: 1.3670 - val_accuracy: 0.5550\n","Epoch 7/100\n","61/61 [==============================] - 37s 600ms/step - loss: 1.3200 - accuracy: 0.5213 - val_loss: 1.1955 - val_accuracy: 0.5725\n","Epoch 8/100\n","61/61 [==============================] - 42s 689ms/step - loss: 1.2500 - accuracy: 0.5467 - val_loss: 1.1843 - val_accuracy: 0.5950\n","Epoch 9/100\n","61/61 [==============================] - 77s 1s/step - loss: 1.2026 - accuracy: 0.5662 - val_loss: 1.1270 - val_accuracy: 0.6025\n","Epoch 10/100\n","61/61 [==============================] - 66s 1s/step - loss: 1.1525 - accuracy: 0.5873 - val_loss: 1.0730 - val_accuracy: 0.6300\n","Epoch 11/100\n","61/61 [==============================] - 61s 1s/step - loss: 1.1114 - accuracy: 0.5939 - val_loss: 1.1288 - val_accuracy: 0.6250\n","Epoch 12/100\n","61/61 [==============================] - 131s 2s/step - loss: 1.0602 - accuracy: 0.6152 - val_loss: 1.0647 - val_accuracy: 0.6175\n","Epoch 13/100\n","61/61 [==============================] - 100s 2s/step - loss: 1.0410 - accuracy: 0.6204 - val_loss: 1.0590 - val_accuracy: 0.6225\n","Epoch 14/100\n","61/61 [==============================] - 132s 2s/step - loss: 0.9935 - accuracy: 0.6360 - val_loss: 1.0696 - val_accuracy: 0.6400\n","Epoch 15/100\n","61/61 [==============================] - 105s 2s/step - loss: 0.9818 - accuracy: 0.6471 - val_loss: 1.0574 - val_accuracy: 0.6325\n","Epoch 16/100\n","61/61 [==============================] - 103s 2s/step - loss: 0.9317 - accuracy: 0.6650 - val_loss: 1.0390 - val_accuracy: 0.6300\n","Epoch 17/100\n","61/61 [==============================] - 162s 3s/step - loss: 0.9140 - accuracy: 0.6699 - val_loss: 1.0487 - val_accuracy: 0.6300\n","Epoch 18/100\n","61/61 [==============================] - 196s 3s/step - loss: 0.8803 - accuracy: 0.6776 - val_loss: 0.9913 - val_accuracy: 0.6425\n","Epoch 19/100\n","61/61 [==============================] - 186s 3s/step - loss: 0.8654 - accuracy: 0.6822 - val_loss: 0.9833 - val_accuracy: 0.6425\n","Epoch 20/100\n","61/61 [==============================] - 190s 3s/step - loss: 0.8382 - accuracy: 0.6946 - val_loss: 1.0351 - val_accuracy: 0.6350\n","Epoch 21/100\n","61/61 [==============================] - 209s 3s/step - loss: 0.8024 - accuracy: 0.7082 - val_loss: 1.0496 - val_accuracy: 0.6500\n","Epoch 22/100\n","61/61 [==============================] - 231s 4s/step - loss: 0.7994 - accuracy: 0.7133 - val_loss: 1.0315 - val_accuracy: 0.6475\n","Epoch 23/100\n","61/61 [==============================] - 233s 4s/step - loss: 0.7575 - accuracy: 0.7254 - val_loss: 0.9238 - val_accuracy: 0.6775\n","Epoch 24/100\n","61/61 [==============================] - 192s 3s/step - loss: 0.7727 - accuracy: 0.7269 - val_loss: 0.9338 - val_accuracy: 0.6850\n","Epoch 25/100\n","61/61 [==============================] - 220s 4s/step - loss: 0.7585 - accuracy: 0.7282 - val_loss: 1.0381 - val_accuracy: 0.6425\n","Epoch 26/100\n","61/61 [==============================] - 131s 2s/step - loss: 0.7473 - accuracy: 0.7395 - val_loss: 0.9671 - val_accuracy: 0.6625\n","Epoch 27/100\n","61/61 [==============================] - 157s 3s/step - loss: 0.7096 - accuracy: 0.7518 - val_loss: 0.9283 - val_accuracy: 0.6925\n","Epoch 28/100\n","61/61 [==============================] - 174s 3s/step - loss: 0.7046 - accuracy: 0.7418 - val_loss: 0.9501 - val_accuracy: 0.6825\n","Epoch 29/100\n","61/61 [==============================] - 181s 3s/step - loss: 0.7157 - accuracy: 0.7418 - val_loss: 0.9376 - val_accuracy: 0.6900\n","Epoch 30/100\n","61/61 [==============================] - 186s 3s/step - loss: 0.6789 - accuracy: 0.7577 - val_loss: 0.8998 - val_accuracy: 0.7050\n","Epoch 31/100\n","61/61 [==============================] - 168s 3s/step - loss: 0.6586 - accuracy: 0.7703 - val_loss: 0.8666 - val_accuracy: 0.7075\n","Epoch 32/100\n","61/61 [==============================] - 186s 3s/step - loss: 0.6475 - accuracy: 0.7641 - val_loss: 0.8425 - val_accuracy: 0.7125\n","Epoch 33/100\n","61/61 [==============================] - 148s 2s/step - loss: 0.6281 - accuracy: 0.7780 - val_loss: 0.8522 - val_accuracy: 0.7150\n","Epoch 34/100\n","61/61 [==============================] - 197s 3s/step - loss: 0.6232 - accuracy: 0.7762 - val_loss: 0.9206 - val_accuracy: 0.6975\n","Epoch 35/100\n","61/61 [==============================] - 190s 3s/step - loss: 0.6184 - accuracy: 0.7831 - val_loss: 0.8520 - val_accuracy: 0.7200\n","Epoch 36/100\n","61/61 [==============================] - 237s 4s/step - loss: 0.5949 - accuracy: 0.7777 - val_loss: 0.8645 - val_accuracy: 0.7100\n","Epoch 37/100\n","61/61 [==============================] - 315s 5s/step - loss: 0.5930 - accuracy: 0.7831 - val_loss: 0.7915 - val_accuracy: 0.7250\n","Epoch 38/100\n","61/61 [==============================] - 193s 3s/step - loss: 0.5857 - accuracy: 0.7929 - val_loss: 0.7884 - val_accuracy: 0.7250\n","Epoch 39/100\n","61/61 [==============================] - 201s 3s/step - loss: 0.5926 - accuracy: 0.7911 - val_loss: 0.7979 - val_accuracy: 0.7175\n","Epoch 40/100\n","61/61 [==============================] - 724s 12s/step - loss: 0.5723 - accuracy: 0.7826 - val_loss: 0.8123 - val_accuracy: 0.7300\n","Epoch 41/100\n","61/61 [==============================] - 917s 15s/step - loss: 0.5674 - accuracy: 0.7972 - val_loss: 0.7751 - val_accuracy: 0.7350\n","Epoch 42/100\n","61/61 [==============================] - 304s 5s/step - loss: 0.5185 - accuracy: 0.8175 - val_loss: 0.7659 - val_accuracy: 0.7400\n","Epoch 43/100\n","61/61 [==============================] - 289s 5s/step - loss: 0.5351 - accuracy: 0.8072 - val_loss: 0.7740 - val_accuracy: 0.7350\n","Epoch 44/100\n","61/61 [==============================] - 271s 4s/step - loss: 0.5184 - accuracy: 0.8121 - val_loss: 0.8007 - val_accuracy: 0.7250\n","Epoch 45/100\n","61/61 [==============================] - 275s 4s/step - loss: 0.5008 - accuracy: 0.8196 - val_loss: 0.7797 - val_accuracy: 0.7275\n","Epoch 46/100\n","61/61 [==============================] - 279s 5s/step - loss: 0.4963 - accuracy: 0.8198 - val_loss: 1.0046 - val_accuracy: 0.7325\n","Epoch 47/100\n","61/61 [==============================] - 272s 4s/step - loss: 0.4936 - accuracy: 0.8244 - val_loss: 0.9001 - val_accuracy: 0.7325\n","Epoch 48/100\n","61/61 [==============================] - 117s 2s/step - loss: 0.5041 - accuracy: 0.8193 - val_loss: 0.9417 - val_accuracy: 0.7075\n","Epoch 49/100\n","61/61 [==============================] - 74s 1s/step - loss: 0.4755 - accuracy: 0.8288 - val_loss: 0.8041 - val_accuracy: 0.7425\n","Epoch 50/100\n","61/61 [==============================] - 71s 1s/step - loss: 0.4882 - accuracy: 0.8226 - val_loss: 0.7710 - val_accuracy: 0.7325\n","Epoch 51/100\n","61/61 [==============================] - 74s 1s/step - loss: 0.4688 - accuracy: 0.8321 - val_loss: 0.7645 - val_accuracy: 0.7425\n","Epoch 52/100\n","61/61 [==============================] - 69s 1s/step - loss: 0.4737 - accuracy: 0.8319 - val_loss: 0.7500 - val_accuracy: 0.7325\n","Epoch 53/100\n","61/61 [==============================] - 68s 1s/step - loss: 0.4508 - accuracy: 0.8357 - val_loss: 0.7411 - val_accuracy: 0.7375\n","Epoch 54/100\n","61/61 [==============================] - 65s 1s/step - loss: 0.4505 - accuracy: 0.8401 - val_loss: 0.7371 - val_accuracy: 0.7550\n","Epoch 55/100\n","61/61 [==============================] - 61s 1s/step - loss: 0.4428 - accuracy: 0.8447 - val_loss: 0.7644 - val_accuracy: 0.7500\n","Epoch 56/100\n","61/61 [==============================] - 64s 1s/step - loss: 0.4224 - accuracy: 0.8504 - val_loss: 0.7577 - val_accuracy: 0.7500\n","Epoch 57/100\n","61/61 [==============================] - 68s 1s/step - loss: 0.4175 - accuracy: 0.8519 - val_loss: 0.7718 - val_accuracy: 0.7425\n","Epoch 58/100\n","61/61 [==============================] - 62s 1s/step - loss: 0.4209 - accuracy: 0.8501 - val_loss: 0.7939 - val_accuracy: 0.7400\n","Epoch 59/100\n","61/61 [==============================] - 62s 1s/step - loss: 0.4328 - accuracy: 0.8475 - val_loss: 0.7966 - val_accuracy: 0.7425\n","Epoch 60/100\n","61/61 [==============================] - 64s 1s/step - loss: 0.4180 - accuracy: 0.8509 - val_loss: 0.7411 - val_accuracy: 0.7500\n","Epoch 61/100\n","61/61 [==============================] - 62s 1s/step - loss: 0.4065 - accuracy: 0.8550 - val_loss: 0.7010 - val_accuracy: 0.7675\n","Epoch 62/100\n","61/61 [==============================] - 67s 1s/step - loss: 0.3961 - accuracy: 0.8596 - val_loss: 0.7542 - val_accuracy: 0.7625\n","Epoch 63/100\n","61/61 [==============================] - 65s 1s/step - loss: 0.4145 - accuracy: 0.8532 - val_loss: 0.7723 - val_accuracy: 0.7525\n","Epoch 64/100\n","61/61 [==============================] - 61s 988ms/step - loss: 0.3955 - accuracy: 0.8555 - val_loss: 0.7749 - val_accuracy: 0.7650\n","Epoch 65/100\n","61/61 [==============================] - 67s 1s/step - loss: 0.3688 - accuracy: 0.8717 - val_loss: 0.7179 - val_accuracy: 0.7650\n","Epoch 66/100\n","61/61 [==============================] - 60s 974ms/step - loss: 0.3896 - accuracy: 0.8588 - val_loss: 0.7422 - val_accuracy: 0.7650\n","Epoch 67/100\n","61/61 [==============================] - 66s 1s/step - loss: 0.3656 - accuracy: 0.8706 - val_loss: 0.7334 - val_accuracy: 0.7600\n","Epoch 68/100\n","61/61 [==============================] - 62s 1s/step - loss: 0.3874 - accuracy: 0.8663 - val_loss: 0.7293 - val_accuracy: 0.7575\n","Epoch 69/100\n","61/61 [==============================] - 63s 1s/step - loss: 0.3963 - accuracy: 0.8606 - val_loss: 0.7009 - val_accuracy: 0.7625\n","Epoch 70/100\n","61/61 [==============================] - 63s 1s/step - loss: 0.3496 - accuracy: 0.8778 - val_loss: 0.6911 - val_accuracy: 0.7625\n","Epoch 71/100\n","61/61 [==============================] - 64s 1s/step - loss: 0.3652 - accuracy: 0.8683 - val_loss: 0.6914 - val_accuracy: 0.7750\n","Epoch 72/100\n","61/61 [==============================] - 64s 1s/step - loss: 0.3463 - accuracy: 0.8740 - val_loss: 0.7537 - val_accuracy: 0.7675\n","Epoch 73/100\n","61/61 [==============================] - 60s 984ms/step - loss: 0.3415 - accuracy: 0.8768 - val_loss: 0.7261 - val_accuracy: 0.7750\n","Epoch 74/100\n","61/61 [==============================] - 68s 1s/step - loss: 0.3554 - accuracy: 0.8753 - val_loss: 0.6921 - val_accuracy: 0.7725\n","Epoch 75/100\n","61/61 [==============================] - 66s 1s/step - loss: 0.3610 - accuracy: 0.8711 - val_loss: 0.6643 - val_accuracy: 0.7850\n","Epoch 76/100\n","61/61 [==============================] - 68s 1s/step - loss: 0.3370 - accuracy: 0.8812 - val_loss: 0.6891 - val_accuracy: 0.7750\n","Epoch 77/100\n","61/61 [==============================] - 64s 1s/step - loss: 0.3265 - accuracy: 0.8858 - val_loss: 0.6970 - val_accuracy: 0.7725\n","Epoch 78/100\n","61/61 [==============================] - 64s 1s/step - loss: 0.3541 - accuracy: 0.8745 - val_loss: 0.6973 - val_accuracy: 0.7800\n","Epoch 79/100\n","61/61 [==============================] - 61s 990ms/step - loss: 0.3228 - accuracy: 0.8814 - val_loss: 0.6511 - val_accuracy: 0.7875\n","Epoch 80/100\n","61/61 [==============================] - 64s 1s/step - loss: 0.3334 - accuracy: 0.8855 - val_loss: 0.6607 - val_accuracy: 0.7975\n","Epoch 81/100\n","61/61 [==============================] - 63s 1s/step - loss: 0.3161 - accuracy: 0.8922 - val_loss: 0.6940 - val_accuracy: 0.7900\n","Epoch 82/100\n","61/61 [==============================] - 64s 1s/step - loss: 0.3198 - accuracy: 0.8850 - val_loss: 0.6809 - val_accuracy: 0.7800\n","Epoch 83/100\n","61/61 [==============================] - 65s 1s/step - loss: 0.3168 - accuracy: 0.8958 - val_loss: 0.6555 - val_accuracy: 0.7975\n","Epoch 84/100\n","61/61 [==============================] - 68s 1s/step - loss: 0.3114 - accuracy: 0.8899 - val_loss: 0.6669 - val_accuracy: 0.7925\n","Epoch 85/100\n","61/61 [==============================] - 63s 1s/step - loss: 0.3045 - accuracy: 0.8886 - val_loss: 0.6692 - val_accuracy: 0.8000\n","Epoch 86/100\n","61/61 [==============================] - 63s 1s/step - loss: 0.2848 - accuracy: 0.9032 - val_loss: 0.6926 - val_accuracy: 0.7950\n","Epoch 87/100\n","61/61 [==============================] - 64s 1s/step - loss: 0.2869 - accuracy: 0.8981 - val_loss: 0.7644 - val_accuracy: 0.7800\n","Epoch 88/100\n","61/61 [==============================] - 70s 1s/step - loss: 0.2903 - accuracy: 0.9007 - val_loss: 0.6504 - val_accuracy: 0.7825\n","Epoch 89/100\n","61/61 [==============================] - 64s 1s/step - loss: 0.3009 - accuracy: 0.8935 - val_loss: 0.6333 - val_accuracy: 0.7950\n","Epoch 90/100\n","61/61 [==============================] - 64s 1s/step - loss: 0.2814 - accuracy: 0.9025 - val_loss: 0.6475 - val_accuracy: 0.7925\n","Epoch 91/100\n","61/61 [==============================] - 62s 1s/step - loss: 0.2845 - accuracy: 0.8973 - val_loss: 0.6412 - val_accuracy: 0.7950\n","Epoch 92/100\n","61/61 [==============================] - 62s 1s/step - loss: 0.2616 - accuracy: 0.9035 - val_loss: 0.6394 - val_accuracy: 0.7950\n","Epoch 93/100\n","61/61 [==============================] - 63s 1s/step - loss: 0.2694 - accuracy: 0.9020 - val_loss: 0.6389 - val_accuracy: 0.8000\n","Epoch 94/100\n","61/61 [==============================] - 62s 1s/step - loss: 0.2623 - accuracy: 0.9068 - val_loss: 0.6564 - val_accuracy: 0.7950\n","Epoch 95/100\n","61/61 [==============================] - 76s 1s/step - loss: 0.2577 - accuracy: 0.9076 - val_loss: 0.6923 - val_accuracy: 0.8000\n"]}],"source":["callbacks = create_folders_and_callbacks1(model_name='ResNet101_config1')\n","\n","\n","# Train the model\n","history = model_final.fit(\n","    x = aug_train_gen,\n","    epochs = 100,\n","    validation_data = valid_gen,\n","    shuffle= True,\n","    callbacks = callbacks,\n",").history"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"rLhJyp1s3cyk","outputId":"ae3ff052-f25c-4804-9edb-f4a075615f43"},"outputs":[{"name":"stderr","output_type":"stream","text":["WARNING:absl:Found untraced functions such as _jit_compiled_convolution_op, _jit_compiled_convolution_op, _jit_compiled_convolution_op, _jit_compiled_convolution_op, _jit_compiled_convolution_op while saving (showing 5 of 104). These functions will not be directly callable after loading.\n"]}],"source":["# Save the model\n","# Save best epoch model\n","model_final.save('resnet101')"]}],"metadata":{"colab":{"provenance":[]},"gpuClass":"standard","kernelspec":{"display_name":"Python 3 (ipykernel)","language":"python","name":"python3"},"language_info":{"codemirror_mode":{"name":"ipython","version":3},"file_extension":".py","mimetype":"text/x-python","name":"python","nbconvert_exporter":"python","pygments_lexer":"ipython3","version":"3.10.0"}},"nbformat":4,"nbformat_minor":0}